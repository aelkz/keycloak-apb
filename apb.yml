version: 1.0
name: keycloak-apb
description: Keycloak - Open Source Identity and Access Management
bindable: True
async: optional
tags:
  - sso
  - keycloak
metadata:
  displayName: Keycloak (APB)
  imageUrl: "https://pbs.twimg.com/profile_images/702119821979344897/oAC05cEB_400x400.png"
  documentationUrl: "http://www.keycloak.org/documentation.html"
  providerDisplayName: "Red Hat, Inc."
  dependencies: ['Postgresql:9.5']
  serviceName: keycloak
plans:
  - name: ephemeral
    description: Deploy keycloak without persistence
    free: True
    metadata:
      displayName: Keycloak ephemeral
    parameters:
    - name: admin_username
      required: True
      default: admin
      type: string
      title: Keycloak admin username
    - name: admin_password
      required: True
      type: string
      display_type: password
      title: Keycloak admin password
    bind_parameters:
    - name: service_name
      title: Name of the service to bind
      type: string
    - name: redirect_uris
      title: Redirect URIs
      description: Valid Redirect URIs a browser can redirect to after a successful login/logout. Simple wildcards are allowed. e.g. https://myservice-myproject.apps.example.com/*
      type: string
  - name: persistent
    description: Deploy keycloak with persistence
    free: True
    default: True
    metadata:
      displayName: Keycloak persistent
    parameters:
    - name: admin_username
      required: True
      default: admin
      type: string
      title: Keycloak admin username
    - name: admin_password
      required: True
      type: string
      display_type: password
      title: Keycloak admin password
    - name: pvc_size
      type: string
      default: 200Mi
      description: Database storage size
      title: Storage size
    bind_parameters:
    - name: service_name
      required: True
      title: Name of the service to bind
      type: string
    - name: redirect_uris
      required: True
      title: Redirect URIs
      description: Valid Redirect URIs a browser can redirect to after a successful login/logout. Simple wildcards are allowed. e.g. https://myservice-myproject.apps.example.com/*
      type: string
  - name: external
    description: Allows authenticating applications to an external Keycloak instance
    free: True
    metadata:
      displayName: Keycloak (external)
    parameters:
    - name: admin_username
      required: True
      default: admin
      type: string
      title: Keycloak admin username
    - name: admin_password
      required: True
      type: string
      display_type: password
      title: Keycloak admin password
    - name: apb_external_keycloak_uri
      required: True
      type: string
      title: External Keycloak URL
      description: Public URL where the applications should redirect to for authentication. Must be resolvable by the browser.
    - name: apb_internal_keycloak_uri
      required: False
      type: string
      title: Internal Keycloak URL
      description: If Keycloak is also deployed on OpenShift, the external Keycloak URL might not be DNS-resolvable. Use `http://service.namespace.svc.cluster.local:service_port` instead. Leave empty to use the External URI.
    bind_parameters:
    - name: service_name
      title: Name of the service to bind
      type: string
    - name: redirect_uris
      title: Redirect URIs
      description: Valid Redirect URIs a browser can redirect to after a successful login/logout. Simple wildcards are allowed. e.g. https://myservice-myproject.apps.example.com/*
      type: string
